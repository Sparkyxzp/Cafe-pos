<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Login - Cafe POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }

        /* Loader Overlay */
        .loader-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .loader { width: 150px; height: 150px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; animation: shake 3s infinite ease-in-out; }
        .cup { position: relative; width: 50px; height: 38px; background-color: #5b4022cb; border: 2px solid #2e2e2e; border-radius: 4px 4px 12px 12px; z-index: 10; animation: cupPulse 6s infinite ease-in-out; margin-bottom: 25px; }
        .cup::before { content: ""; position: absolute; bottom: -6px; width: calc(100% - 2px); height: 6px; background: #5b4022cb; border: 2px solid #2e2e2e; border-top: none; border-radius: 50%; z-index: -1; animation: cupPulse 6s infinite ease-in-out; left: -1px; }
        .cup::after { content: ""; position: absolute; top: -3px; left: 0; width: 100%; height: 5px; background: #da8920ca; border: 2px solid #2e2e2e; border-radius: 50%; animation: coffeeGlow 6s infinite ease-in-out; box-sizing: border-box;}
        .cup-handle { position: absolute; top: 5px; right: -14px; width: 12px; height: 18px; border: 3px solid #2e2e2e; border-left: none; border-radius: 0 10px 10px 0; background: transparent; }
        .smoke { position: absolute; bottom: 100%; left: 50%; width: 8px; height: 25px; background: rgba(109, 109, 109, 0.6); border-radius: 50%; transform: translateX(-50%); animation: rise 2.5s infinite ease-in-out; filter: blur(4px); z-index: 5; }
        .smoke.one { animation-delay: 0s; }
        .smoke.two { animation-delay: 0.8s; }
        .smoke.three { animation-delay: 1.6s; }
        .load { font-size: 16px; font-weight: bold; color: #4a4a4a; letter-spacing: 1px; text-align: center; white-space: nowrap; margin-top: 10px; }
        
        @keyframes rise { 0% { transform: translate(-50%, 0) scale(0.4); opacity: 0; } 30% { opacity: 0.8; } 60% { opacity: 0.5; } 100% { transform: translate(-50%, -60px) scale(1.2); opacity: 0; } }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(-3deg); } 50% { transform: rotate(0); } 75% { transform: rotate(3deg); } 100% { transform: rotate(0); } }
        @keyframes cupPulse { 0%, 100% { background-color: #5b4022cb; } 50% { background-color: #6d4c29; } }
        @keyframes coffeeGlow { 0%, 100% { background: #da8920ca; } 50% { background: #eab366; } }

        /* Modal Animation */
        @keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .modal-box { animation: popIn 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-100 to-orange-200 h-screen flex items-center justify-center p-4">
    <div id="app" class="w-full max-w-md">

        <div v-if="isLoading" class="loader-overlay">
            <div class="loader">
                <div class="cup">
                    <div class="cup-handle"></div>
                    <div class="smoke one"></div>
                    <div class="smoke two"></div>
                    <div class="smoke three"></div>
                </div>
                <div class="load">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            </div>
        </div>

        <div v-if="showErrorModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4" @click.self="showErrorModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full text-center modal-box border-b-4 border-red-500">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-3xl">‚ùå</span>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
                <p class="text-gray-600 mb-6 text-sm">Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î<br>‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                <button @click="showErrorModal = false" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-xl transition shadow-lg active:scale-95">
                    ‡∏ï‡∏Å‡∏•‡∏á
                </button>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden relative">
            <div class="bg-orange-600 p-8 text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/coffee.png')] opacity-10"></div>
                <div class="relative z-10">
                    <div class="text-6xl mb-2">‚òï</div>
                    <h1 class="text-3xl font-extrabold text-white tracking-wide">CAFE POS</h1>
                    <p class="text-orange-100 text-sm mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü</p>
                </div>
            </div>
            
            <div class="p-8 space-y-6">
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2 ml-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="cursor-pointer">
                            <input type="radio" v-model="role" value="guest" class="hidden peer">
                            <div class="border-2 border-gray-100 rounded-xl p-4 text-center hover:bg-gray-50 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:text-orange-600 transition">
                                <div class="text-3xl mb-1">üôã‚Äç‚ôÇÔ∏è</div>
                                <div class="font-bold text-sm">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" v-model="role" value="admin" class="hidden peer">
                            <div class="border-2 border-gray-100 rounded-xl p-4 text-center hover:bg-gray-50 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:text-orange-600 transition">
                                <div class="text-3xl mb-1">üë®‚Äçüç≥</div>
                                <div class="font-bold text-sm">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
                            </div>
                        </label>
                    </div>
                </div>

                <transition name="fade">
                    <div v-if="role === 'admin'" class="space-y-4 bg-orange-50 p-4 rounded-xl border border-orange-100">
                        <div>
                            <label class="block text-gray-700 text-xs font-bold mb-1 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</label>
                            <input v-model="username" type="text" :class="{'border-red-500 ring-1 ring-red-200': isError}" class="w-full bg-white text-gray-800 border border-gray-200 rounded-lg py-2 px-3 focus:outline-none focus:border-orange-500 transition text-sm" placeholder="admin">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-xs font-bold mb-1 ml-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)</label>
                            <input v-model="password" type="password" @keyup.enter="handleLogin" :class="{'border-red-500 ring-1 ring-red-200': isError}" class="w-full bg-white text-gray-800 border border-gray-200 rounded-lg py-2 px-3 focus:outline-none focus:border-orange-500 transition text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                    </div>
                </transition>

                <button @click="handleLogin" class="w-full bg-orange-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-orange-700 transition transform hover:-translate-y-1 active:scale-95 flex justify-center items-center gap-2">
                    <span>üöÄ</span> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
            <div class="bg-gray-50 p-4 text-center text-xs text-gray-400">
                Cafe POS System ¬© 2024
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    role: 'guest',
                    username: '',
                    password: '',
                    isLoading: false,
                    showErrorModal: false,
                    isError: false
                }
            },
            watch: {
                role(newVal) {
                    if (newVal === 'guest') {
                        this.username = ''; this.password = ''; this.isError = false;
                    }
                },
                username() { if(this.isError) this.isError = false; },
                password() { if(this.isError) this.isError = false; }
            },
            methods: {
                async handleLogin() {
                    // 1. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Guest
                    if (this.role === 'guest') {
                        this.startLoading('guest.html');
                        return;
                    }

                    // 2. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÅ‡∏ï‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
                    if (!this.username || !this.password) {
                        this.showErrorModal = true;
                        this.isError = true;
                        return;
                    }

                    // 3. ‚úÖ ‡∏¢‡∏¥‡∏á API ‡πÑ‡∏õ‡∏ñ‡∏≤‡∏° Server
                    try {
                        const response = await fetch('http://localhost:3000/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                username: this.username,
                                password: this.password
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            // ‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                            this.startLoading('admin.html');
                        } else {
                            // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                            this.showErrorModal = true;
                            this.isError = true;
                        }
                    } catch (error) {
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ');
                        console.error(error);
                    }
                },
                startLoading(url) {
                    this.isLoading = true;
                    setTimeout(() => {
                        window.location.href = url;
                    }, 1500);
                }
            }
        }).mount('#app')
    </script>
</body>
</html>